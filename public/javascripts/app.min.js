_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var NoteDictionary=function(){var noteList=["A","A#","Bb","B","C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab"],notes=["A","A#/Bb","B","C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab"],notesSharp=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],notesFlat=["A","Bb","B","C","Db","D","Eb","E","F","Gb","G","Ab"],intervals=["P1","m2","M2","m3","M3","P4","d5","P5","m6","M6","m7","M7"],scales={chromatic:{intervals:intervals},pentatonic:{intervals:["P1","m3","P4","d5","P5","m7"]},augmented:{intervals:["P1","M2","M3","d5","m6","m7"]},diminished:{intervals:["P1","m2","m3","M3","d5","P5","M6","m7"]},major:{intervals:["P1","M2","M3","P4","P5","M6","M7"]},dorian:{intervals:["P1","M2","m3","P4","P5","M6","m7"]},phrygian:{intervals:["P1","m2","m3","P4","P5","m6","m7"]},lydian:{intervals:["P1","M2","M3","d5","P5","M6","M7"]},mixolydian:{intervals:["P1","M2","M3","P4","P5","M6","m7"]},Aeolian:{intervals:["P1","M2","m3","P4","P5","m6","m7"]},Locrian:{intervals:["P1","m2","m3","P4","d5","m6","m7"]},"harmonic major":{intervals:["P1","M2","M3","P4","P5","m6","M7"]},"melodic major":{intervals:["P1","M2","M3","P4","P5","m6","m7"]},minor:{intervals:["P1","M2","m3","P4","P5","m6","m7"]}},chords={major:{intervals:["P1","M3","P5"]},m:{intervals:["P1","m3","P5"]},dim:{intervals:["P1","m3","d5"]},aug:{intervals:["P1","M3","m6"]},6:{intervals:["P1","M3","P5","M6"]},m6:{intervals:["P1","m3","P5","M6"]},"6/9":{intervals:["P1","M2","M3","P5","M6"]},maj7:{intervals:["P1","M3","P5","M7"]},7:{intervals:["P1","M3","P5","m7"]},"7b5":{intervals:["P1","M3","d5","m7"]},"7#5":{intervals:["P1","M3","m6","m7"]},m7:{intervals:["P1","m3","P5","m7"]},"m7(maj7)":{intervals:["P1","m3","P5","M7"]},m7b5:{intervals:["P1","m3","d5","m7"]},dim7:{intervals:["P1","m3","d5","m7"]},9:{intervals:["P1","M2","M3","P5","m7"]},"9b5":{intervals:["P1","M2","M3","d5","m7"]},"9#5":{intervals:["P1","M2","M3","m6","m7"]},maj9:{intervals:["P1","M2","M3","P5","M7"]},m9:{intervals:["P1","M2","m3","P5","m7"]},m11:{intervals:["P1","m3","P4","P5","m7"]},13:{intervals:["P1","M3","P5","M6","m7"]},maj13:{intervals:["P1","M3","P5","M6","M7"]},sus4:{intervals:["P1","P4","P5"]},sus2:{intervals:["P1","M2","P5"]},"7sus4":{intervals:["P1","P4","P5","m7"]},"7sus2":{intervals:["P1","M2","P5","m7"]},"9sus4":{intervals:["P1","M2","P4","P5","m7"]},"9sus2":{intervals:["P1","M2","P5","m7"]},5:{intervals:["P1","P5"]}};function notesToChord(noteArray){var intr=IndexesToValues(notesToIndexes(noteArray),intervals),result=_.keys(chords);return _.filter(result,function(i){if(_.isEqual(intr,chords[i].intervals))return i})}function notesToIndexes(noteArray){var n=shiftNotes(_.indexOf(notes,noteArray[0]));return _.map(noteArray,function(note){return _.indexOf(n,note)})}function IntervalsToIndexes(intervalArray){return _.map(intervalArray,function(int){return _.indexOf(intervals,int)})}function IndexesToValues(indexesArray,valuesArray){return _.map(indexesArray,function(i){return valuesArray[i]})}function shiftNotes(keyIndex){return notes.slice(keyIndex).concat(notes.slice(0,keyIndex))}function getNotes(key,intervals){var newNotesArray,indexes,targetNotes=key.charAt(1)==="b"?notesFlat:notesSharp;newNotesArray=shiftNotes(_.indexOf(targetNotes,key));indexes=IntervalsToIndexes(intervals);return IndexesToValues(indexes,newNotesArray)}function validateKey(key){if(key&&key.length>0&&key.charAt(0).match(/^[a-gA-G]/))return key.charAt(1)==="b"||key.charAt(1)==="#"?key.charAt(0).toUpperCase()+key.charAt(1):key.charAt(0).toUpperCase()}return{parseQuery:function(query){if(!(query.length>0))return!1;var key=validateKey(query);if(key){var modifier=query.substr(key.length).replace(/^\s+/,"");return query.charCodeAt(key.length)===32?this.getScale(key,modifier):this.getChord(key,modifier)}},getScale:function(key,scale){return scales[scale]?{key:key,scale:scale,notes:getNotes(key,scales[scale].intervals),intervals:scales[scale].intervals,isScale:!0}:{key:key,scale:scale,notes:[],intervals:[],isScale:!0}},getChord:function(key,chord){chord=chord?chord:"major";return chords[chord]&&key?{key:key,chord:chord,notes:getNotes(key,chords[chord].intervals),intervals:chords[chord].intervals,isScale:!1}:{key:key,chord:chord,notes:[],intervals:[],isScale:!1}},getChordsOfScale:function(query,returnAsObject){var scale=this.parseQuery(query),scaleNotes=scale.notes,triads=[],chordArray=[],key;for(var i=0,l=scale.notes.length;i<l;i++){triads[i]=notesToChord([scaleNotes[0],scaleNotes[2],scaleNotes[4]]);key=scaleNotes[0].length>2?scaleNotes[0].substr(0,2):scaleNotes[0];returnAsObject?chordArray.push(this.getChord(key,triads[i])):chordArray.push(key+""+(triads[i]==="major"?"":triads[i]));scaleNotes.push(scaleNotes.shift())}return chordArray},isChordInScale:function(chord,scale){return _.intersection(chord.notes,scale.notes).length===chord.notes.length},getScalesOfChord:function(query,returnAsObject){var chord=this.parseQuery(query),scalesArray=[],noteArray;chord.key.charAt(1)=="b"?noteArray=notesFlat:noteArray=notesSharp;for(var i=0,l=noteArray.length;i<l;i++)for(var mod in scales)if(mod!="chromatic"){var scale=this.parseQuery(noteArray[i]+" "+mod);this.isChordInScale(chord,scale)&&(returnAsObject?scalesArray.push(scale):scalesArray.push(noteArray[i]+" "+scale.scale))}return scalesArray},getAllDefinitions:function(){var definitions=[],modifiers=[];for(var key in chords)chords.hasOwnProperty(key)&&modifiers.push(key=="major"?"":key);for(var key in scales)scales.hasOwnProperty(key)&&modifiers.push(" "+key);var l=modifiers.length;for(var i=0;i<17;i++)for(var j=0;j<l;j++)definitions.push(noteList[i]+modifiers[j]);return definitions}}}();typeof exports!="undefined"&&(exports=module.exports=NoteDictionary);var App=function(App){App.Router=Backbone.Router.extend({routes:{"":"setInstrument","instrument/:name":"setInstrument"},initialize:function(options){App.dispatcher=_.clone(Backbone.Events);App.notesCollection=new App.NotesCollection},setInstrument:function(name){var instrument={bass:["E","A","D","G"],guitar:["E","A","D","G","B","E"],ukulele:["G","C","E","A"]},strings=instrument[name]||instrument.guitar;this.createFretboardView(strings)},createFretboardView:function(strings){App.searchView=App.searchView||new App.SearchView;App.chordDefinitionView=App.chordDefinitionView||new App.ChordDefinitionView({model:new App.ChordDefinitionModel});App.stringsCollection=App.stringsCollection||new App.StringCollection([]);App.stringsCollection.reset();App.stringsCollection.initialize(strings);App.fretboard=App.fretboard||new App.FretboardView}});return App}(App||{}),App=function(App){App.NotesCollection=Backbone.Collection.extend({dictionary:NoteDictionary,flatNeutralSharp:0,initialize:function(){var octave=NoteDictionary.getScale("A","chromatic").notes;for(var i=0;i<12;i++)this.add(new App.NoteModel({note:octave[i]}));_.bindAll(this,"activate");App.dispatcher.on("chordChange",this.activate);App.dispatcher.on("scaleChange",this.activate)},getModel:function(note){return _.find(this.models,function(t){return t.attributes.note===note})},activate:function(e){_.each(this.models,function(model){model.reset()});for(var i=0,l=e.notes.length;i<l;i++){var note=e.notes[i],target=this.getModel(note),interval=e.intervals[i];target.set({active:!0,interval:interval})}},setActiveNotes:function(query){var result=this.dictionary.parseQuery(query);if(result&&result.notes.length!==0){if(result.notes[0].length>1){var c=result.notes[0].charAt(1);c==="#"?this.flatNeutralSharp=1:this.flatNeutralSharp=-1}else flatNeutralSharp=0;var e=result.isScale?"scaleChange":"chordChange";App.dispatcher.trigger(e,result)}}});return App}(App||{}),App=function(App){App.NoteModel=Backbone.Model.extend({defaults:{note:undefined,active:!1,interval:""},initialize:function(){},reset:function(){this.set({active:!1,interval:""})}});return App}(App||{}),App=function(App){App.StringModel=Backbone.Model.extend({defaults:{key:undefined,octave:[]},initialize:function(){this.set({key:this.attributes.key},{silent:!0});this.set({octave:NoteDictionary.getScale(this.attributes.key,"chromatic").notes},{silent:!0})}});return App}(App||{}),App=function(App){App.StringCollection=Backbone.Collection.extend({initialize:function(strings){strings.reverse();for(var i=0,l=strings.length;i<l;i++)this.add(new App.StringModel({key:strings[i]}))}});return App}(App||{}),App=function(App){App.ChordDefinitionModel=Backbone.Model.extend({defaults:{name:undefined,notes:undefined,intervals:[],definition:""},initialize:function(options){_.bindAll(this,"update");App.dispatcher.on("chordChange",this.update)},update:function(e){var name=e.key+""+(e.chord==="major"?"":e.chord),int=e.intervals,notes=_.map(e.notes,function(note){note.length>1&&(App.notesCollection.flatNeutralSharp>=0?note=note.substr(0,2):note=note.substr(3,2));return note});this.set({name:name,intervals:int,notes:notes})}});return App}(App||{}),App=function(App){App.SearchView=Backbone.View.extend({el:"#search",events:{keyup:"handleEnter"},initialize:function(){_.bindAll(this);this.router=this.options.router;$(this.el).autocomplete({lookup:NoteDictionary.getAllDefinitions(),onSelect:this.handleEnter});$(this.el).focus()},handleEnter:function(e){$(this.el).val()&&App.notesCollection.setActiveNotes($(this.el).val())}});return App}(App||{}),App=function(App){App.NoteView=Backbone.View.extend({tagName:"li",className:"inactive",initialize:function(options){_.bindAll(this,"render");this.note=options.note;this.stringPosition=options.stringPosition;this.model=App.notesCollection.getModel(this.note);this.model.bind("change",this.render);this.render()},render:function(){this.model.attributes.active?$(this.el).html(this.model.attributes.note).removeClass("inactive").addClass(this.model.attributes.interval):$(this.el).html(this.model.attributes.note).removeClass().addClass("inactive pos-"+this.stringPosition)}});return App}(App||{}),App=function(App){App.StringView=Backbone.View.extend({tagName:"ul",className:"string",initialize:function(){_.bindAll(this,"render");this.render()},render:function(){var l=this.model.attributes.octave.length;for(var i=0;i<l;i++){var n=new App.NoteView({note:this.model.attributes.octave[i],stringPosition:i});$(this.el).append(n.el)}}});return App}(App||{}),App=function(App){App.FretboardView=Backbone.View.extend({el:"ul#neck",initialize:function(options){for(var i=0,l=App.stringsCollection.models.length;i<l;i++){var string=new App.StringView({model:App.stringsCollection.models[i]});$(this.el).append(string.el)}}});return App}(App||{}),App=function(App){App.ChordDefinitionView=Backbone.View.extend({el:"#chord-definition",template:$("#definitionTemplate").html(),initialize:function(){_.bindAll(this,"render");this.model.bind("change",this.render)},render:function(){var json=this.model.toJSON();$(this.el).html(_.template(this.template,json));return this}});return App}(App||{}),App=function(App){App.start=function(){App.router=new App.Router;Backbone.history.start({pushState:!0})};return App}(App||{});App.start();